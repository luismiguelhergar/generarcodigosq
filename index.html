<!-- index.html -->
<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Generador de QR</title>
  <link rel="stylesheet" type="text/css" href="estilos.css">
</head>

  <body>
    <h2>Crear código QR</h2>

    <form onsubmit="generarQr(event)">
      <label for="inputText">Enlace:</label><br>
      <input type="text" id="inputText" name="inputText"><br>

      <label for="size">Tamaño QR</label>
      <select id="size" name="size">
        <option value="128">Pequeño</option>
        <option value="256">Mediano</option>
        <option value="512">Grande</option>
      </select><br><br>

      <input type="submit" value="Generar QR"><br><br>
      <button onclick="generarYDescargar('png')">Descargar en PNG</button><br><br>
      <button onclick="generarYDescargar('svg')">Descargar en SVG</button><br>
    </form>

    <div id="qrcode"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <script type="text/javascript">
      var nuevoQr = document.getElementById("qrcode");

      function generarQr(event) {
        if (event) {
          event.preventDefault();
        }

        var inputValue = document.getElementById("inputText").value;
        var size = document.getElementById("size").value;

        nuevoQr.innerHTML = "";

        new QRCode(nuevoQr, {
          text: inputValue,
          width: parseInt(size),
          height: parseInt(size),
          colorDark: "#000000",
          colorLight: "#ffffff",
          correctLevel: QRCode.CorrectLevel.Q,
        });
      }

      function generarYDescargar(tipo) {
        generarQr();

        setTimeout(function() {
          if (tipo === 'png') {
            descargarPNG();
          } else if (tipo === 'svg') {
            descargarSVG();
          }
        }, 500);
      }

      function descargarPNG() {
        var img = nuevoQr.querySelector("img");
        if (img) {
          var imgSrc = img.src;
          var a = document.createElement('a');
          a.href = imgSrc;
          a.download = "qrcode.png";
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
        }
      }

      function descargarSVG() {
        var svg = nuevoQr.querySelector("svg");
        if (svg) {
          var svgData = new XMLSerializer().serializeToString(svg);
          var blob = new Blob([svgData], { type: 'image/svg+xml' });
          var url = URL.createObjectURL(blob);
          var a = document.createElement('a');
          a.href = url;
          a.download = "qrcode.svg";
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        }
      }
    </script>
  </body>
</html>
